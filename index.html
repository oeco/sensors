<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="../dist/leaflet.css" />
</head>
<body>
	<div id="map" style="width: 400px; height: 300px"></div>

	<script src="../dist/jquery-1.11.1.min.js"></script>
	<script src="../dist/underscore-min.js"></script>	
	<script src="../dist/async.js"></script>	
	<script src="../dist/leaflet.js"></script>
	<script src="../lib/sensors.js"></script>

	<script>
		var map = L.map('map').setView([-14.82,-49.09515], 4);
		var xively_endpoint = "https://api.xively.com/v2/feeds/";
		var sensors_geojson;

		L.tileLayer('http://{s}.tiles.mapbox.com/v3/infoamazonia.h17kafbd/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
		}).addTo(map);

		// var fetchSensorData = function(feed_id, x_apikey, callback) {
		// 	$.ajax({
		// 		url: xively_endpoint+feed_id,
		// 		type: 'GET',
		// 		dataType: 'json',
		// 		beforeSend: function(request) {
		// 			request.setRequestHeader("X-ApiKey", x_apikey);
		// 		},
		// 		success: function(data) { callback(null, data) },
		// 		error: function(err) { callback(err) }
		// 	});
		// }

		// function getDatastream(feed_id, x_apikey, start, duration, callback){
		// 	// https://api.xively.com/v2/feeds/2001586077.json?start=2014-05-05T&duration=6hours
		// 	start = start || '2014-05-05T';
		// 	duration = duration || '6hours';
		// 	$.ajax({
		// 		url: xively_endpoint+feed_id,
		// 		type: 'GET',
		// 		data: { start: start, duration: duration},
		// 		dataType: 'json',
		// 		beforeSend: function(request) {
		// 			request.setRequestHeader("X-ApiKey", x_apikey);
		// 		},
		// 		success: function(data) { callback(null, data) },
		// 		error: function(err) { callback(err) }
		// 	});
		// }

		// getDatastream('2001586077', "h21DurKJ4UwlM7fTB7BHP5APwxtUK69ALi2sjfDtgtfUnUwD", null, null, function(err, data){
		// 	console.log(data);
		// })

		$.getJSON("sensors.geojson", function(geojson) {

			var features = [];

			parseSensorGeoJSON(geojson, function(){
				// geojson.features = features;
				// console.log(features);
				// L.geoJson(geojson,{
				// 	pointToLayer: function(feature, latlng) {
				// 		var myStyle = {
				// 			radius: 3,
				// 			fillColor: "#ff7800",
				// 			color: "#000",
				// 			weight: 1,
				// 			opacity: 1,
				// 			fillOpacity: 1
				// 		};

				// 		if (feature.properties.datastreams[0].current_value > 100) {
				// 			myStyle.fillColor = 'red';
				// 		} else {
				// 			myStyle.fillColor = 'green';							
				// 		}
				// 		return L.circleMarker(latlng, myStyle);
				// 	},
				// 	onEachFeature: function (feature, layer) {
				// 		var popupContent = 
				// 				"<p>"+feature.properties.title+"<p>" +
				// 				"<p>PM10: "+feature.properties.datastreams[0].current_value+"<p>" +
				// 				"<p>PM2.5: "+feature.properties.datastreams[2].current_value+"<p>";

				// 		layer.bindPopup(popupContent);
				// 	}
				// }).addTo(map);
			});

		});


	</script>
</body>
</html>
